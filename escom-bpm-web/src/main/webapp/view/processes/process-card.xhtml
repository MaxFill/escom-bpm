<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                template="/view/templ/templ-card.xhtml">

    <ui:param name="_bean" value="#{processCardBean}"/>

    <ui:define name="customStyleCSS">
        <style type="text/css">
            .ui-diagram-task {
                border:0.1em dotted #E5E4E2;
                border-radius: 4px;
                background-color: #EFEEEC;
                width:8em;
                height:8em;
                text-align: center;
                box-shadow: 0 5px 10px rgba(0, 0, 0, 0.8);
            }

            .ui-diagram-element:hover {
                background-color: #C7C6C4;
            }

            .ui-diagram-logic {
                width:3em;
                height:3em;
                line-height:5em;
                box-shadow: 0 5px 10px rgba(0, 0, 0, 0.8);
                border-radius: 5em;
                border: 1px solid #404a4e;
                background-color: #099b05;
                color: #ffffff;
                font-weight: bold;
            }

            .ui-diagram-success-state {
                width:10em;
                height:6em;
                background-color: #02b044;
                color: #ffffff;
                border-color: #7ab02c;
                box-shadow: 0 5px 10px rgba(0, 0, 0, 0.8);
            }

            .ui-diagram-fail-state {
                width:10em;
                height:6em;
                background-color: #C33730;
                color: #ffffff;
                box-shadow: 0 5px 10px rgba(0, 0, 0, 0.8);
            }

            .d16 {
                margin: 20px 0; width: 100px; height: 50px;
                line-height:5em;
                background: #F1009A;
                box-shadow: 0 5px 10px rgba(0, 0, 0, 0.8);
                position: relative;}
            .d16:before, .d16:after {
                content: "";
                width: 0; height: 0;
                position: absolute; left: 0;
                border-left: 50px solid transparent;
                border-right: 50px solid transparent;}
            .d16:before {
                top: -25px;
                border-bottom: 25px solid #F1009A;}
            .d16:after {
                bottom: -25px;
                border-top: 25px solid #F1009A;}
            .d16:hover {
                background-color: #C7C6C4;
            }

        </style>
    </ui:define>

    <ui:define name="card_scripts">
        <script type="text/javascript">
            $(document).on('click', '.ui-diagram > .ui-diagram-element',
                function(info) {
                    var xPos = Math.round(info.target.offsetLeft / parseFloat($("body").css("font-size")));
                    var yPos = Math.round(info.target.offsetTop / parseFloat($("body").css("font-size")));
                    elementClicked([
                        {name : 'elementId',value : info.target.id},
                        {name : 'posX',     value : xPos},
                        {name : 'posY',     value : yPos}
                    ]);
                });
        </script>
        <p:remoteCommand name="elementClicked" actionListener="#{processCardBean.onElementClicked}"/>
    </ui:define>

    <ui:define name="page_body">
        <p:tab id="cardTab" title="#{bundle.Process}">
            <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank ui-grid-col-12" columnClasses="ui-grid-col-12">
                <p:outputLabel value="#{bundle.Name}" indicateRequired="true" />
                    <p:inputText id="nameItem" value="#{processCardBean.editedItem.name}"
                                 styleClass="ui-grid-col-12 col-padding"
                                 onkeypress="checkEsc(#{_bean.cancelBtnName});"
                                 onchange="return itemChange = 1;"
                                 disabled="#{processCardBean.isReadOnly()}"
                                 required="#{param['isRequired'] == 'true'}"
                                 requiredMessage="#{bundle.Field} [#{bundle.Name}] #{bundle.MustBeFilled}"/>
            </p:panelGrid>
        </p:tab>

        <p:tab title="#{bundle.Scheme}" >
            <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank ui-grid-col-12" columnClasses="ui-grid-col-12">
                <p:toolbar styleClass="ui-grid-col-12" >
                    <f:facet name="left">
                        <p:commandButton  title="#{bundle.AddTask}" icon="ui-icon-plus"
                                        disabled="#{processCardBean.isReadOnly()}"
                                        onstart="PF('statusDialog').show()"
                                        oncomplete="PF('statusDialog').hide();"
                                        actionListener="#{staffBean.onManySelectItem()}" >
                           <p:ajax event="dialogReturn" listener="#{processCardBean.onStaffsSelected}" />
                        </p:commandButton>
                        <p:commandButton  value="And" title="#{bundle.AddLogicElement}"
                                          disabled="#{processCardBean.isReadOnly()}"
                                          actionListener="#{processCardBean.onAddLogicElement('and')}" >
                        </p:commandButton>
                        <p:commandButton  value="Or" title="#{bundle.AddLogicElement}"
                                          disabled="#{processCardBean.isReadOnly()}"
                                          actionListener="#{processCardBean.onAddLogicElement('or')}" >
                        </p:commandButton>
                        <p:commandButton  value="If" title="#{bundle.AddCondition}"
                                          disabled="#{processCardBean.isReadOnly()}"
                                          actionListener="#{processCardBean.onAddConditionElement()}" >
                        </p:commandButton>
                        <p:commandButton  value="State" title="#{bundle.AddState}"
                                          disabled="#{processCardBean.isReadOnly()}"
                                          actionListener="#{processCardBean.onAddStateElement('success')}" >
                        </p:commandButton>
                        <span class="ui-separator">
                            <span class="ui-icon ui-icon-grip-dotted-vertical" />
                        </span>

                        <p:commandButton title="Load" icon="ui-icon-folder-open"
                                         actionListener="#{processCardBean.loadModel()}"
                                         update="diagramm">
                        </p:commandButton>
                        <p:commandButton title="Clear" icon="ui-icon-closethick"
                                         actionListener="#{processCardBean.clearModel()}"
                                         update="diagramm">
                        </p:commandButton>
                        <p:commandButton type="button" title="Print" icon="ui-icon-print"/>
                    </f:facet>

                    <f:facet name="right">
                        <p:menuButton value="Options">
                            <p:menuitem value="Save" actionListener="#{processCardBean.saveModel()}" icon="ui-icon-disk" />
                            <p:menuitem value="Reload" actionListener="#{processCardBean.reloadModel()}" update="diagramm" icon="ui-icon-arrowrefresh-1-w" />
                            <p:menuitem value="Clear" actionListener="#{processCardBean.clearModel()}" update="diagramm" icon="ui-icon-close" />
                        </p:menuButton>
                    </f:facet>
                </p:toolbar>

                <p:diagram id="diagramm" value="#{processCardBean.model}" style="height:600px" styleClass="ui-widget-content ui-grid-col-12" var="el">
                    <f:facet name="element">
                        <h:outputText value="#{el.caption}" style="display:block;"/>
                        <h:panelGroup rendered="#{processCardBean.canShowTaskFacet(el) }">
                            <h:outputText value="#{el.staff != null ? el.staff.name : bundle.NotAssigned}" style="display:block;"/>
                            <p:splitButton value="#{bundle.Open}" actionListener="#{processCardBean.onOpenElement(el)}" icon="ui-icon-extlink">
                                <p:menuitem value="#{bundle.Delete}" actionListener="#{processCardBean.onDeleteElement(el)}" icon="ui-icon-close" />
                            </p:splitButton>
                        </h:panelGroup>
                    </f:facet>
                    <p:ajax event="connect" listener="#{processCardBean.onConnect}" />
                    <p:ajax event="disconnect" listener="#{processCardBean.onDisconnect}" />
                    <p:ajax event="connectionChange" listener="#{processCardBean.onConnectionChange}" />
                </p:diagram>
            </p:panelGrid>
        </p:tab>
    </ui:define>

</ui:composition>