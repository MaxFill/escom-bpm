<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:p="http://primefaces.org/ui"
                template="/view/templ/templ.xhtml">

    <ui:define name="initBeans">
        <script type="text/javascript" src="Resources/dynamsoft.webtwain.initiate.js"/>
        <script type="text/javascript" src="Resources/dynamsoft.webtwain.config.js"/>
        <script type="text/javascript" src="Resources/dynamsoft.webtwain.install.js"/>
        <link type="text/css" rel="stylesheet" href="Resources/reference/hint.css" />
        <link type="text/css" rel="stylesheet" href="Resources/reference/html5_editor.css"/>  
    </ui:define>

    <ui:define name="title">
        #{bundle.Scan}
    </ui:define>

    <ui:param name="_frm" value="scanform" />

    <ui:define name="preRendered">
        <f:metadata>
            <f:event type="preRenderView" listener="#{scanBean.onOpenCard()}"/>
        </f:metadata>
    </ui:define>

    <ui:define name="body">
        <h:outputScript library="js" name="custom-dwtwain.js" />
        <pe:layout fullPage="true" options="#{scanBean.layoutOptions}" widgetVar="fpLayoutWidget">
            <p:ajax event="resize" listener="#{scanBean.handleResize}"/> 
            <pe:layoutPane position="center" resizable="true">
                <h:form id="#{_frm}" styleClass="formLayoute">

                    <h:inputHidden id="maxFileSize" value="#{scanBean.scanHelper.maxFileSize}" />
                    <h:inputHidden id="productKey" value="#{scanBean.scanHelper.productKey}" />
                    <h:inputHidden id="isTrial" value="#{scanBean.scanHelper.isTrial}"/>                         

                    <p:hotkey bind="esc" id="hotskey"
                              immediate="true"                             
                              onstart="document.getElementById('#{_frm}:btnClose').click();"> 
                    </p:hotkey>

                    <p:menubar styleClass="without-spaces">
                        <p:submenu label="#{bundle.Actions}" icon="ui-icon-gear" styleClass="submenu">
                            <p:menuitem icon="ui-icon-circle-arrow-e" value="#{bundle.Scaning}"
                                        onclick="document.getElementById('#{_frm}:btnScan').click();"> 
                            </p:menuitem>
                            <p:separator />
                            <p:menuitem icon="ui-icon-circle-close" value="#{bundle.Close}"
                                        onclick="document.getElementById('#{_frm}:btnClose').click();"> 
                            </p:menuitem>
                        </p:submenu>                
                        <f:facet name="options">
                            <p:commandButton widgetVar="saveButtonWidget" value="#{bundle.SaveAndClose}"
                                             icon="ui-icon-disk"
                                             onclick="Neoflex.prepareScannedImageToSave()"
                                             action="#{scanBean.onSaveAndClose()}">
                                <f:param name="isRequired" value="true"/>
                            </p:commandButton>
                            <p:commandButton id="btnClose" icon="ui-icon-circle-close" style="float:right;"
                                             title="#{bundle.Close}"
                                             immediate="true"
                                             action="#{scanBean.onCloseCard()}"> 
                            </p:commandButton> 
                        </f:facet>
                    </p:menubar>

                    <p:messages id="messages" showDetail="true" autoUpdate="true" closable="true" styleClass="ui-panelgrid-blank ui-grid-col-12 col-padding"/>

                    <p:panelGrid columns="3" layout="grid" columnClasses="ui-grid-col-3, ui-grid-col-1, ui-grid-col-8" styleClass="ui-grid-col-12 col-padding">
                        <p:panelGrid columns="1" layout="grid" columnClasses="ui-grid-col-12" styleClass="ui-grid-col-12 col-padding">                            
                            <p:outputLabel value="#{bundle.Name}" />
                            <h:panelGroup styleClass="ui-grid-col-12">
                                <p:inputText value="#{scanBean.model.fileName}" styleClass="ui-grid-col-8"
                                             required="#{param['isRequired'] == 'true'}" 
                                             requiredMessage="#{bundle.Field} [#{bundle.FileName}] #{bundle.MustBeFilled}"/>
                                <p:selectOneMenu id="fileExtension" 
                                                 required="#{param['isRequired'] == 'true'}" 
                                                 requiredMessage="#{bundle.Field} [#{bundle.FileFormat}] #{bundle.MustBeFilled}"
                                                 widgetVar="fileExtensionWidget"
                                                 onchange="Neoflex.changeFileExtension()"
                                                 value="#{scanBean.model.fileExtensionValue}">
                                    <f:selectItems value="#{scanBean.model.fileExtensions}"
                                                   var="_fileExtension" itemLabel="#{_fileExtension.label}"
                                                   itemValue="#{_fileExtension.value}"/>
                                </p:selectOneMenu>
                            </h:panelGroup>
                            <p:commandButton widgetVar="scanButtonWidget" id="btnScan" value="#{bundle.Scaning}"
                                             icon="ui-icon-circle-arrow-e"
                                             process="@this"/>
                            <p:separator />
                            
                            <select size="1" id="source" style="position: relative; width: 200px;"></select>
                            
                            <p:selectBooleanCheckbox id="cbShowUI" widgetVar="myCheckboxWidget" itemLabel="#{bundle.ShowScanerUI}"/>                                                            
                            
                            <div id="dwtcontrolContainer" style="float: left; min-width: 200px; width: 100%; height: 350px;"></div>
                        </p:panelGrid>
                        
                        <!-- основные кнопки управления -->
                        <p:panelGrid columns="1" layout="grid" columnClasses="ui-grid-col-12" styleClass="ui-grid-col-12 col-padding">
                            <p:commandButton widgetVar="rotate180BtnWidget" value="#{bundle.Rotate180}" 
                                             onclick="Rotate180();"
                                             icon="ico_done" process="@this" styleClass="ui-grid-col-12 col-padding"/>
                            <p:commandButton widgetVar="rotateLeftBtnWidget" value="#{bundle.RotateLeft}" 
                                             onclick="RotateLeft();"
                                             icon="ico_done" process="@this" styleClass="ui-grid-col-12 col-padding"/>
                            <p:commandButton widgetVar="rotateRightBtnWidget" value="#{bundle.RotateRight}" 
                                             onclick="RotateRight();"
                                             icon="ico_done" process="@this" styleClass="ui-grid-col-12 col-padding"/>
                            <p:commandButton widgetVar="deleteButtonWidget" value="#{bundle.DeleteSelected}" title="#{RemoveSelectedImages}"
                                             icon="ico_cancel" process="@this" styleClass="ui-grid-col-12 col-padding"/> 
                            <p:commandButton widgetVar="deleteButtonWidgetAll" value="#{bundle.DeleteAll}" title="#{RemoveAlImages}"
                                             icon="ico_cancel" process="@this" styleClass="ui-grid-col-12 col-padding"/> 
                        </p:panelGrid>
                        
                        <!-- окно просмоторщика --> 
                        <p:panelGrid columns="1" layout="grid" columnClasses="ui-grid-col-12" styleClass="ui-grid-col-12 col-padding">
                            <div id="dwtcontrolContainerLargeViewer" style="float: left; min-width: 300px; width: 100%; height: 450px;"></div>
                            <h:inputHidden id="image" value="#{scanBean.model.imageStringBase64}" />
                        </p:panelGrid>                        
                        
                        <!-- кнопки навигации -->
                        <p:panelGrid columns="1" layout="grid" columnClasses="ui-grid-col-12" styleClass="ui-grid-col-12 col-padding"> 
                            <input onclick="btnFirstImage_onclick()" type="button" value=" first " />
                            <input onclick="btnPreImage_onclick()" type="button" value=" back " />
                            <input type="text" size="2" id="DW_CurrentImage" readonly="readonly" value="0" />
                            <input type="text" size="2" id="DW_TotalImage" readonly="readonly" value="0" />
                            <input onclick="btnNextImage_onclick()" type="button" value=" next " />
                            <input onclick="btnLastImage_onclick()" type="button" value=" last " />
                            <p:outputLabel value="Preview Mode:" />
                            <select size="1" id="DW_PreviewMode" onchange="setlPreviewMode();">
                                <option value="0">1X1</option>
                                <option value="1">1X3</option>
                                <option value="2">1X5</option>                             
                            </select>                            
                        </p:panelGrid>                   
                    </p:panelGrid>
                </h:form>
            </pe:layoutPane>
        </pe:layout>  
    </ui:define>

</ui:composition>