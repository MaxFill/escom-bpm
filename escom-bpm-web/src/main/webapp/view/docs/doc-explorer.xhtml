<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    template="/view/templ/templ-explorer.xhtml">  

    <ui:define name="title">
        <h:outputText value="#{bundle.FolderExplorer}"></h:outputText>
    </ui:define>

    <ui:param name="_detailBean" value="#{docsBean}" />
    <ui:param name="_treeBean" value="#{foldersBean}" /> 
    <ui:param name="_searcheBean" value="#{_detailBean}"/>

    <ui:param name="_selectorHeader" value="#{explorerBean.getLabelFromBundle('DocSelector')}"/>
    <ui:param name="_explorerHeader" value="#{explorerBean.getLabelFromBundle('DocsExplorer')}"/>

    <ui:param name="_showAuthor"      value="#{true}"/>
    <ui:param name="_showDateCreate"  value="#{false}"/>
    <ui:param name="_showDateChange"  value="#{true}"/>    
    <ui:param name="_showUploadPanel" value="#{true}"/>
    <ui:param name="_showCompany"     value="#{true}"/>

    <ui:param name="_CreateGroupLabel" value="#{bundle.CreateFolder}" />
    <ui:param name="_CreateItemLabel" value="#{bundle.CreateDoc}" />
    <ui:param name="_updates" value="fileUploadFRM" />
    
    <!-- специфичные поля поиска -->
    <ui:define name="searche"> 
        <p:selectCheckboxMenu value="#{explorerBean.model.docTypes}" label="#{bundle.DocTypeSelector}" converter="docsTypesConvertor"
                              filter="true" filterMatchMode="startsWith" styleClass="ui-grid-col-12">
            <f:selectItems value="#{docTypeBean.findAll()}" var="item" itemLabel="#{item.getName()}" itemValue="#{item}"/>
        </p:selectCheckboxMenu>

        <p:outputLabel value="#{bundle.Number}"/>
        <p:inputText title="#{bundle.HelpSearcheContext}"
                     value="#{explorerBean.model.numberSearche}"
                     styleClass="ui-grid-col-12"
                     onkeypress="keyPress();">
        </p:inputText>
        
        <p:selectBooleanCheckbox itemLabel="#{bundle.DateDoc}" widgetVar="cbDateDoc"
                                 title="#{bundle.SearcheDateDoc}" 
                                 value="#{explorerBean.model.dateDocSearche}">
            <p:ajax event="change" update="pnDateDocSearche"/>
        </p:selectBooleanCheckbox>   
        
        <h:panelGroup id="pnDateDocSearche"> 
            <p:panelGrid columns="2" layout="grid" columnClasses="col10r ui-grid-col-1" 
                         rendered="#{explorerBean.model.dateDocSearche}">
                #{bundle.With}
                <p:calendar value="#{explorerBean.model.dateDocStart}" id="dateDocStart" 
                            showButtonPanel="true" navigator="true" yearRange="c-120:c+20" 
                            locale="#{sessionBean.locale}"
                            required="#{explorerBean.model.dateDocSearche and param['isRequired'] == 'true'}"
                            requiredMessage="#{bundle.Field} [#{bundle.DateDoc}: #{bundle.With}] #{bundle.MustBeFilled}"
                            disabled="#{!explorerBean.model.dateDocSearche}">
                </p:calendar>
            </p:panelGrid>
            <p:panelGrid columns="2" layout="grid" columnClasses="col10r ui-grid-col-1" 
                         rendered="#{explorerBean.model.dateDocSearche}">
                #{bundle.At}
                <p:calendar value="#{explorerBean.model.dateDocEnd}" id="dateDocEnd" 
                            showButtonPanel="true" navigator="true" yearRange="c-120:c+20" 
                            locale="#{sessionBean.locale}"
                            required="#{explorerBean.model.dateDocSearche and param['isRequired'] == 'true'}"
                            requiredMessage="#{bundle.Field} [#{bundle.DateDoc}: #{bundle.At}] #{bundle.MustBeFilled}"
                            disabled="#{!explorerBean.model.dateDocSearche}">
                </p:calendar>
            </p:panelGrid>
        </h:panelGroup>
    </ui:define>
    
    <!-- специфичные пункты в меню тулбара обозревателя -->
    <ui:define name="addMenuActions">
        <p:menuitem icon="ui-icon-mail-closed" value="#{bundle.SendToEmailAsAttache}" title="#{bundle.SendToEmailAsAttache}"
                    disabled="#{explorerBean.checkedItems.isEmpty()}"
                    actionListener="#{explorerBean.prepareSendMailDocs('asAttache')}"/>
        <p:menuitem icon="ui-icon-mail-closed" value="#{bundle.SendToEmailAsLink}" title="#{bundle.SendToEmailAsLink}"
                    disabled="#{explorerBean.checkedItems.isEmpty()}"
                    actionListener="#{explorerBean.prepareSendMailDocs('asLink')}"/> 
        <p:separator />
    </ui:define>   

    <!-- специфичные поля таблицы обозревателя -->
    <ui:define name="specDetailColumns">
        <p:column headerText="#{bundle.Type}" sortBy="#{item.docType.name}" >
            <h:outputText value="#{item.getClass().getSimpleName() == 'Doc' ? item.docType.name : bundle.Folder}"/>
        </p:column>

        <p:column headerText="#{bundle.Number}" sortBy="#{item.number}" >            
            <h:outputText value="#{item.regNumber}"/>            
        </p:column>
        <p:column headerText="#{bundle.DateDoc}" width="90" priority="2"
                  sortBy="#{item.dateDoc}">
            <h:outputLabel value="#{item.getClass().getSimpleName() == 'Doc' ? item.dateDoc : ''}">
                <f:convertDateTime type="date" dateStyle="short" timeStyle="short" locale="#{sessionBean.locale}" timeZone="#{TimeZone.getDefault()}"/>
            </h:outputLabel>
        </p:column>
    </ui:define> 

    <ui:define name="specCommandLinks">
        <p:commandLink value="#{item.nameEndElipse}" title="#{item.name}" 
                       rendered="#{item.getClass().getSimpleName() == 'Doc'}"
                       actionListener="#{explorerBean.onViewDocument(item)}">
        </p:commandLink>
    </ui:define>    
    
    <ui:define name="addItemMenu">
        <p:menuitem icon="ui-icon-pencil" value="#{docsBean.docIsLock(item) ? bundle.UnLock : bundle.EditVersion}" 
                    actionListener="#{explorerBean.onSetCurrentItem(item)}"
                    disabled="#{item.attache == null}"
                    rendered="#{item.getClass().getSimpleName() == 'Doc'}"
                    oncomplete="document.getElementById('#{_frmExpl}:editDocument').click();"/>
        <p:menuitem icon="ui-icon-zoomin" value="#{bundle.ViewDoc}" 
                    rendered="#{item.getClass().getSimpleName() == 'Doc'}"
                    disabled="#{item.attache == null}"
                    actionListener="#{docsBean.onViewAttache(item.getAttache())}"/>
        <p:menuitem icon="ui-icon-arrowthickstop-1-s" value="#{bundle.Download}"
                    ajax="false"
                    onstart="return isClose = 1;"
                    rendered="#{explorerBean.isItemHaveAttache(item)}"
                    action="#{docsBean.attacheDownLoad(item.getAttache())}"/>
        <p:separator />
        <p:menuitem icon="ui-icon-plus" value="#{bundle.ADD_VERSION}"
                    rendered="#{item.getClass().getSimpleName() == 'Doc'}"
                    actionListener="#{docsBean.openAttacheAddForm(item)}"/>
        <p:menuitem icon="ui-icon-clipboard" value="#{bundle.AddVersionFromScan}"
                    rendered="#{item.getClass().getSimpleName() == 'Doc'}"
                    actionListener="#{explorerBean.onSetCurrentItem(item)}"
                    oncomplete="document.getElementById('#{_frmExpl}:btnScan').click();"/> 
        <p:separator />
        <p:menuitem icon="ui-icon-folder-open" value="#{bundle.ShowInFolder}" 
                    rendered="#{item.getClass().getSimpleName() == 'Doc'}" 
                    update="#{_frmTree} #{_frmExpl}"
                    actionListener="#{explorerBean.onShowDocInFolder(item)}"
                    oncomplete="initDND()"/>
    </ui:define>

    <ui:define name="addMenuCreates" >        
    </ui:define>
    
    <ui:define name="addToolButtons">  
        <span class="ui-separator">
            <span class="ui-icon ui-icon-grip-dotted-vertical" />
        </span>
        <p:menuButton value="#{bundle.Reports}" >
            <p:menuitem value="#{bundle.DocReportCountTypes}" 
                        icon="ui-icon-note"
                        actionListener="#{docsBean.openDocCountTypesReport()}"/>
        </p:menuButton>        
    </ui:define>
</ui:composition>