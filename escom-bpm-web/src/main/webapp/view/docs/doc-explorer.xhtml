<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    template="/view/templ/templ-explorer.xhtml">  

    <ui:define name="title">
        <h:outputText value="#{bundle.FolderExplorer}"></h:outputText>
    </ui:define>

    <ui:param name="_explorerBean" value="#{folderExplBean}"/>
    <ui:param name="_detailBean" value="#{docsBean}" />
    <ui:param name="_treeBean" value="#{foldersBean}" /> 
    <ui:param name="_searcheBean" value="#{_detailBean}"/>

    <ui:param name="_selectorHeader" value="#{_explorerBean.getLabelFromBundle('DocSelector')}"/>
    <ui:param name="_explorerHeader" value="#{_explorerBean.getLabelFromBundle('DocsExplorer')}"/>

    <ui:param name="_showAuthor"      value="#{true}"/>
    <ui:param name="_showDateCreate"  value="#{false}"/>
    <ui:param name="_showDateChange"  value="#{true}"/>    
    <ui:param name="_showUploadPanel" value="#{_explorerBean.selectorViewMode ? false : true}"/>
    <ui:param name="_showCompany"     value="#{true}"/>

    <ui:param name="_CreateGroupLabel" value="#{bundle.CreateFolder}" />
    <ui:param name="_CreateItemLabel" value="#{bundle.CreateDoc}" />
    <ui:param name="_updates" value="fileUploadFRM" />
    
    <!-- специфичные поля поиска -->
    <ui:define name="searche">         
        <p:selectBooleanCheckbox itemLabel="#{bundle.FullTextSearche}" widgetVar="cbFullSearche"
                                 title="#{bundle.FullTextSearcheMode}"
                                 value="#{_explorerBean.model.fullTextSearche}">
        </p:selectBooleanCheckbox>
        
        <p:selectCheckboxMenu value="#{_explorerBean.model.docTypes}" label="#{bundle.DocTypeSelector}"
                              widgetVar="cbmDocType"
                              converter="docsTypesConvertor"
                              filter="true" filterMatchMode="startsWith" styleClass="ui-grid-col-12">
            <f:selectItems value="#{docTypeBean.findAll()}" var="item" itemLabel="#{item.getName()}" itemValue="#{item}"/>
        </p:selectCheckboxMenu>

        <p:outputLabel value="#{bundle.Number}"/>
        <div class="ui-inputgroup">
            <p:inputText title="#{bundle.HelpSearcheContext}" value="#{_explorerBean.model.numberSearche}"
                     widgetVar="docNumberSearche"
                     styleClass="ui-grid-col-12"
                     onkeypress="keyPress();">
            </p:inputText>
            <p:commandButton styleClass="btnClear" icon="ui-icon-close" onclick="PF('docNumberSearche').jq.val('');"/>
        </div>
        
        <p:selectBooleanCheckbox itemLabel="#{bundle.DateDoc}" widgetVar="cbDateDoc"
                                 title="#{bundle.SearcheDateDoc}" 
                                 value="#{_explorerBean.model.dateDocSearche}">
            <p:ajax event="change" update="pnDateDocSearche"/>
        </p:selectBooleanCheckbox>   
        
        <h:panelGroup id="pnDateDocSearche"> 
            <p:panelGrid columns="2" columnClasses="col10r ui-grid-col-1" 
                         rendered="#{_explorerBean.model.dateDocSearche}">
                #{bundle.With}
                <p:calendar value="#{_explorerBean.model.dateDocStart}" id="dateDocStart" 
                            widgetVar="dateDocStartSearche"
                            navigator="true" yearRange="c-120:c+20"
                            locale="#{sessionBean.locale}"
                            required="#{_explorerBean.model.dateDocSearche and param['isRequired'] == 'true'}"
                            requiredMessage="#{bundle.Field} [#{bundle.DateDoc}: #{bundle.With}] #{bundle.MustBeFilled}"
                            disabled="#{!_explorerBean.model.dateDocSearche}">
                </p:calendar>
            </p:panelGrid>
            <p:panelGrid columns="2" columnClasses="col10r ui-grid-col-1" 
                         rendered="#{_explorerBean.model.dateDocSearche}">
                #{bundle.At}
                <p:calendar value="#{_explorerBean.model.dateDocEnd}" id="dateDocEnd"
                            widgetVar="dateDocEndSearche"
                            navigator="true" yearRange="c-120:c+20"
                            locale="#{sessionBean.locale}"
                            required="#{_explorerBean.model.dateDocSearche and param['isRequired'] == 'true'}"
                            requiredMessage="#{bundle.Field} [#{bundle.DateDoc}: #{bundle.At}] #{bundle.MustBeFilled}"
                            disabled="#{!_explorerBean.model.dateDocSearche}">
                </p:calendar>
            </p:panelGrid>
        </h:panelGroup>
        
        <p:outputLabel value="#{bundle.Partner}"/>
        <p:selectOneMenu value="#{_explorerBean.model.partnerSearche}" filter="true" converter="partnersConvertor" 
                        widgetVar="partnerSearche"
                        styleClass="ui-grid-col-12">
                <f:selectItems value="#{partnersBean.findAll()}" var="partner" itemValue="#{partner}" itemLabel="#{partner.nameEndElipse}" />
                <f:selectItem value="#{null}" itemLabel="#{bundle.NotSpecified}" itemValue="#{null}"/>
            </p:selectOneMenu>  
    </ui:define>
    
    <!-- специфичные пункты в меню тулбара обозревателя -->
    <ui:define name="addMenuActions">
        <p:menuitem icon="ui-icon-mail-closed" value="#{bundle.SendToEmailAsAttache}" title="#{bundle.SendToEmailAsAttache}"
                    disabled="#{_explorerBean.checkedItems.isEmpty()}"
                    onclick="document.getElementById('#{_frmExpl}:btnSendDocAttache').click();"/>
        <p:menuitem icon="ui-icon-mail-closed" value="#{bundle.SendToEmailAsLink}" title="#{bundle.SendToEmailAsLink}"
                    disabled="#{_explorerBean.checkedItems.isEmpty()}"
                    onclick="document.getElementById('#{_frmExpl}:btnSendDocLink').click();"/>
        <p:separator />
    </ui:define>   

    <ui:define name="btnDisplayNone" >
        <p:commandButton id="btnSendDocAttache" actionListener="#{_explorerBean.prepareSendMailDocs('asAttache')}" style="display: none;">
            <p:ajax event="dialogReturn" listener="#{docsBean.onAfterSendDocToEmail}"
                    update="#{_frmExpl}:messages"
                    oncomplete="initDND()"/>
        </p:commandButton>
        <p:commandButton id="btnSendDocLink" actionListener="#{_explorerBean.prepareSendMailDocs('asLink')}" style="display: none;">
            <p:ajax event="dialogReturn" listener="#{docsBean.onAfterSendDocToEmail}"
                    update="#{_frmExpl}:messages"
                    oncomplete="initDND()"/>
        </p:commandButton>
    </ui:define>

    <!-- специфичные поля таблицы обозревателя -->
    <ui:define name="specDetailColumns">
        <p:column headerText="#{bundle.Type}" sortBy="#{item.docType.name}" >
            <h:outputText value="#{item.getClass().getSimpleName() == 'Doc' ? item.docType.name : bundle.Folder}"/>
        </p:column>

        <p:column headerText="#{bundle.Number}" sortBy="#{item.number}"  >
            <h:outputText value="#{item.regNumber}"/>            
        </p:column>
        <p:column headerText="#{bundle.DateDoc}" width="90" priority="2" rendered="#{_explorerBean.isNowShowDetail()}"
                  sortBy="#{item.dateDoc}">
            <h:outputLabel value="#{item.dateDoc}">
                <f:convertDateTime type="date" dateStyle="short" timeStyle="short" locale="#{sessionBean.locale}" timeZone="#{TimeZone.getDefault()}"/>
            </h:outputLabel>
        </p:column>
    </ui:define> 

    <ui:define name="specCommandLinks">
        <p:commandLink value="#{item.nameEndElipse}" title="#{item.name}" 
                       rendered="#{item.getClass().getSimpleName() == 'Doc'}"
                       actionListener="#{_explorerBean.onViewDocument(item)}">
        </p:commandLink>
    </ui:define>    
    
    <ui:define name="addItemMenu">
        <p:menuitem icon="ui-icon-pencil" value="#{docsBean.docIsLock(item) ? bundle.UnLock : bundle.EditVersion}" 
                    actionListener="#{_explorerBean.onSetCurrentItem(item)}"
                    disabled="#{item.mainAttache == null}"
                    rendered="#{item.getClass().getSimpleName() == 'Doc'}"
                    oncomplete="document.getElementById('#{_frmExpl}:editDocument').click();"/>
        <p:menuitem icon="ui-icon-zoomin" value="#{bundle.ViewDoc}" 
                    rendered="#{item.getClass().getSimpleName() == 'Doc'}"
                    disabled="#{item.mainAttache == null}"
                    actionListener="#{docsBean.onViewAttache(item.getAttache())}"/>
        <p:menuitem icon="ui-icon-arrowthickstop-1-s" value="#{bundle.Download}"
                    ajax="false"
                    onstart="return isClose = 1;"
                    rendered="#{_explorerBean.isItemHaveAttache(item)}"
                    action="#{sessionBean.attacheDownLoad(item.getAttache())}"/>
        <p:separator />
        <p:menuitem icon="ui-icon-plus" value="#{bundle.ADD_VERSION}"
                    rendered="#{item.getClass().getSimpleName() == 'Doc'}"
                    actionListener="#{docsBean.openAttacheAddForm(item)}"/>
        <p:menuitem icon="ui-icon-clipboard" value="#{bundle.AddVersionFromScan}"
                    rendered="#{item.getClass().getSimpleName() == 'Doc'}"
                    actionListener="#{_explorerBean.onSetCurrentItem(item)}"
                    oncomplete="document.getElementById('#{_frmExpl}:btnScan').click();"/> 
        <p:separator />
        <p:menuitem icon="ui-icon-folder-open" value="#{bundle.ShowInFolder}" 
                    rendered="#{item.getClass().getSimpleName() == 'Doc'}" 
                    update="#{_frmTree} #{_frmExpl}"
                    actionListener="#{_explorerBean.onShowDocInFolder(item)}"
                    oncomplete="initDND()"/>
    </ui:define>

    <ui:define name="addMenuCreates" >        
    </ui:define>
    
    <ui:define name="addToolButtons">  
        <span class="ui-separator">
            <span class="ui-icon ui-icon-grip-dotted-vertical" />
        </span>
        <p:menuButton value="#{bundle.Reports}" >
            <p:menuitem value="#{bundle.DocReportCountTypes}" 
                        icon="ui-icon-note"
                        onstart="PF('statusDialog').show()"
                        oncomplete="PF('statusDialog').hide();"
                        actionListener="#{docsBean.openDocCountTypesReport()}"/>
            <p:menuitem value="#{bundle.DocJournal}" 
                        icon="ui-icon-note"
                        onstart="PF('statusDialog').show()"
                        oncomplete="PF('statusDialog').hide();"
                        actionListener="#{_explorerBean.openDocJournalReport()}"/>
        </p:menuButton>        
    </ui:define>
</ui:composition>