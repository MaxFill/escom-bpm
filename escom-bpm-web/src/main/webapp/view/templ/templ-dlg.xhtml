<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                template="/view/templ/templ.xhtml">

    <ui:param name="_canClose" value="#{_canClose == null ? true : _canClose}"/> 
    <ui:param name="_isShowHelp" value="#{_isShowHelp == null ? true : _isShowHelp}" />
    
    <ui:define name="body">
        <ui:insert name="initBean"/>

        #{_bean.onBeforeOpenCard()}
        #{_bean.onAfterFormLoad()}
                
        <p:importConstants type="com.maxfill.dictionary.DictStates" var="DictStates" />  
        
        <h:form id="mainFRM" style="font-size: 90%; height: 100%;" styleClass="ui-grid-col-12" onkeypress="checkEsc();">
            <p:hotkey bind="esc" id="hotskey" immediate="true" onstart="checkEsc();"/>            

            <script type="text/javascript">
                $(function () {
                    $(':input').bind('keydown', 'esc', function () {
                        checkEsc();
                        return false;
                    });
                });
            </script>
            
            <p:panel header="#{_bean.getFormHeader()}" rendered="#{_bean != null}" styleClass="ui-grid-col-12 ui-draggable without-spaces" style="height: 100%;" >
                <f:facet name="actions">
                    <p:commandLink id="btnClose" type="button" title="#{bundle.Close}" immediate="true" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default"
                                   rendered="#{_bean.getSourceBeanId() != null}"
                                   disabled="#{!_canClose}"
                                   actionListener="#{_bean.onCancelItemSave()}" 
                                   onclick="if (itemChange == 1){
                                        onChangeItem();
                                    } 
                                    sendFormSize();">
                        <h:outputText styleClass="ui-icon ui-icon-closethick" />
                    </p:commandLink>
                </f:facet>                                

                <p:panelGrid layout="grid" columns="#{_bean.mainGridColumnCount}" columnClasses="#{_bean.mainGridColumnStyleClass}" styleClass="ui-grid-col-12 without-spaces">

                    <p:panel id="westFRM" rendered="#{_bean.isWestShow()}" styleClass="ui-grid-col-12 without-spaces" style="height: 100%;">
                        <f:facet name="header">
                            <ui:insert name="leftFormHeader"/>
                        </f:facet>
                        <ui:insert name="leftFormContent"/>
                    </p:panel>

                    <p:panel id="centerFRM" styleClass="ui-grid-col-12 without-spaces" style="height: 100%;">
                        <f:facet name="header">
                            <ui:insert name="centerFormHeader"/>
                        </f:facet>
                        <p:panelGrid columns="1" layout="grid" columnClasses="ui-grid-col-12 col-padding" styleClass="ui-grid-col-12 without-spaces">                            
                            
                            <p:toolbar id="explToolBar">
                                <f:facet name="left">
                                <ui:insert name="toolbarComponents"/>
                                </f:facet>
                                <f:facet name="right">
                                    <ui:insert name="specToolButtons"/>
                                    <p:spacer width="10"/>
                                    <p:menuButton value="#{bundle.Actions}" icon="ui-icon-gear">
                                        <ui:insert name="menuActions" />  
                                        <p:separator />
                                        <p:menuitem value="#{bundle.ManualBook}" icon="ui-icon-help" rendered="#{_isShowHelp}" 
                                                    onstart="PF('statusDialog').show()"
                                                    oncomplete="PF('statusDialog').hide();"
                                                    actionListener="#{sessionBean.onViewHelp()}"/>
                                    </p:menuButton>
                                </f:facet>
                            </p:toolbar>  
                            
                            <p:messages id="messages" showDetail="false" closable="true" styleClass="ui-grid-col-12 without-spaces">
                                <p:autoUpdate />
                            </p:messages>
                            
                            <ui:insert name="centerFormContent"/>
                            <ui:insert name="extCenterPanel"/> 
                        </p:panelGrid>
                        <f:facet name="footer">
                            <ui:insert name="centerFormFooter"/>
                        </f:facet>
                    </p:panel>

                    <p:panel id="eastFRM" rendered="#{_bean.isEastShow()}" styleClass="ui-grid-col-12 without-spaces" style="height: 100%;">
                        <f:facet name="header">
                            <ui:insert name="rightFormHeader"/>
                        </f:facet>
                        <ui:insert name="rightFormContent"/>
                    </p:panel>

                </p:panelGrid>
            </p:panel>

            <ui:insert name="form_scripts"/>
                                  
            <ui:include src="/view/common/confirm-dlg.xhtml"/>
            <p:remoteCommand name="formSize" actionListener="#{_bean.onFormSize()}" />
            <p:remoteCommand name="onChangeItem" immediate="true" actionListener="#{_bean.onItemChange()}" oncomplete="return itemChange = 0;"/> 
        </h:form>

    </ui:define>

</ui:composition>