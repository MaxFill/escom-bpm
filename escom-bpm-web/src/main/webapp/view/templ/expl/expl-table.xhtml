<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"    
                xmlns:h="http://java.sun.com/jsf/html" 
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:p="http://primefaces.org/ui">
   
    <p:dataTable id="tblDetail" value="#{_explorerBean.detailItems}" var="item" 
                 emptyMessage="#{bundle.EmptyTable}"
                 paginator="true" paginatorPosition="bottom" first="#{_explorerBean.currentPage}"
                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                 rowsPerPageTemplate="5, 10, 15, 20, 35, 50, 75" rows="#{_explorerBean.rowsInPage}"
                 currentPageReportTemplate="#{bundle.CountRecords}: {totalRecords}, #{bundle.Showing} {startRecord}-{endRecord} "
                 tableStyle="table-layout: auto;" styleClass="ui-grid-col-12 without-spaces"
                 sortMode="multiple" sortBy="#{_explorerBean.sortOrder}"
                 selection="#{_explorerBean.checkedItems}"
                 rowKey="#{item.itemKey}">

        <p:ajax event="rowSelect" update="centerFRM:explToolBar" oncomplete="initDND();" />
        <p:ajax event="rowDblselect" 
                listener="#{_explorerBean.onRowDblClckOpen}"
                oncomplete="document.getElementById('centerFRM:viewCardBtn').click();"/>
        <p:ajax event="rowSelectCheckbox" update="centerFRM:explToolBar" oncomplete="initDND()"/>
        <p:ajax event="rowUnselectCheckbox" update="centerFRM:explToolBar" oncomplete="initDND()"/>
        <p:ajax event="toggleSelect" update="centerFRM:explToolBar" oncomplete="initDND()"/>
        <p:ajax event="page" listener="#{_explorerBean.onPageChange}" oncomplete="initDND()"/>             
        
        <p:column width="16" selectionMode="multiple" style="text-align:center"/>
        
        <p:column width="16" sortBy="#{item.iconName}" id="colIcon">
            <p:graphicImage id="itemIcon" value="/resources/icon/#{item.iconName}.png" styleClass="#{item.deleted ? '' : 'dropoint'}"/> 
        </p:column>

        <p:column headerText="#{bundle.Name}" sortBy="#{item.nameEndElipse}" id="shortName">
            <p:commandLink value="#{item.nameEndElipse}" title="#{item.name}" 
                           rendered="#{_explorerBean.isItemTreeType(item)}"
                           actionListener="#{_explorerBean.onLoadGroupContent(item)}"
                           update="centerFRM westFRM centerHeaderLabel #{_updates}" 
                           oncomplete="initDND()"/>
            <p:commandLink value="#{item.nameEndElipse}" title="#{item.name}"
                           rendered="#{!_explorerBean.isItemTreeType(item) and item.getClass().getSimpleName() != 'Doc'}"
                           actionListener="#{_explorerBean.onSetCurrentItem(item)}"
                           oncomplete="document.getElementById('centerFRM:editCardBtn').click();">
            </p:commandLink>
            <ui:insert name="specCommandLinks"/>
        </p:column>

        <ui:insert name="specDetailColumns" />
        <ui:insert name="specTreeColumns"/>
        <ui:insert name="specRootColumns"/>
        
        <p:column width="16" sortBy="#{item.state.currentState.name}">
            <h:graphicImage id="iconDone" value="#{item.state.currentState.icon}" title="#{stateBean.getBundleName(item.state.currentState)}"/>            
        </p:column>
        
        <p:column headerText="#{bundle.DateChange}" width="90" priority="3"
                  rendered="#{_showDateChange != false}"
                  sortBy="#{item.dateChange}">
            <h:outputLabel value="#{item.dateChange}">
                <f:convertDateTime type="both" dateStyle="short" timeStyle="short" locale="#{sessionBean.locale}" timeZone="#{TimeZone.getDefault()}"/>
            </h:outputLabel>
        </p:column>

        <p:column headerText="#{bundle.DateCreate}" width="90" priority="3"
                  rendered="#{_showDateCreate != false}"
                  sortBy="#{item.dateCreate}">
            <h:outputLabel value="#{item.dateCreate}">
                <f:convertDateTime type="both" dateStyle="short" timeStyle="short" locale="#{sessionBean.locale}" timeZone="#{TimeZone.getDefault()}"/>
            </h:outputLabel>
        </p:column>

        <p:column headerText="#{bundle.Owner}" priority="4"
                  rendered="#{_showAuthor == true}"
                  sortBy="#{item.author.shortFIO}">
            #{item.author.shortFIO}
        </p:column>

        <p:column headerText="Id" sortBy="#{item.id}" priority="5">
            <h:outputText value="#{item.id}"/>
        </p:column>

        <p:column style="text-align: center;" width="90" >
            <p:splitButton  value="#{bundle.Select}"
                            rendered="#{!item.deleted and item.actual and _explorerBean.selectorViewMode}" 
                            action="#{_explorerBean.onSelect(item)}">                
                <p:menuitem value="#{bundle.View}" icon="ui-icon-search"
                            actionListener="#{_explorerBean.onSetCurrentItem(item)}"
                            oncomplete="document.getElementById('centerFRM:editCardBtn').click();"/>
                <p:menuitem value="#{bundle.Edit}" icon="ui-icon-pencil"
                            actionListener="#{_explorerBean.onSetCurrentItem(item)}"
                            oncomplete="document.getElementById('centerFRM:viewCardBtn').click();"/>
            </p:splitButton>                      
                        
            <p:splitButton value="#{bundle.Edit}"
                           actionListener="#{_explorerBean.onSetCurrentItem(item)}"
                           rendered="#{!item.deleted and _explorerBean.explorerViewMode}"                           
                           oncomplete="document.getElementById('centerFRM:viewCardBtn').click();">
                <ui:insert name="addItemMenu" />                 
                <p:separator/>
                <p:menuitem icon="ui-icon-search" value="#{bundle.ViewCard}" 
                            actionListener="#{_explorerBean.onSetCurrentItem(item)}"
                            oncomplete="document.getElementById('centerFRM:editCardBtn').click();"/>
                <p:separator/>

                <p:menuitem icon="ui-icon-copy" value="#{bundle.Copy}"
                            update="centerFRM:explToolBar"
                            actionListener="#{_explorerBean.onCopyItem(item)}"/>

                <p:menuitem icon="ui-icon-trash" value="#{bundle.MoveToTrash}"
                            disabled="#{item.id == 0}"
                            update="westFRM centerFRM"
                            actionListener="#{_explorerBean.onMoveContentToTrash(item)}"
                            oncomplete="initDND()">
                    <p:confirm header="#{bundle.Move}" message="#{bundle.ConfirmMoveToTrash}" icon="ui-icon-alert" />
                </p:menuitem>

                <p:separator/>
                <p:menuitem icon="ui-icon-star" value="#{bundle.AddToFavorites}" 
                            rendered="#{!_explorerBean.isFavoriteSelected()}"
                            actionListener="#{_explorerBean.onAddContentInFavorites(item)}"/>
                <p:menuitem icon="ui-icon-scissors" value="#{bundle.DeleteFromFavorites}" 
                            rendered="#{_explorerBean.isFavoriteSelected()}"
                            actionListener="#{_explorerBean.onDelContentFromFavorites(item)}"
                            update="centerFRM"
                            oncomplete="initDND()"/>
                <p:separator/>
                <p:menuitem icon="ui-icon-key" value="#{bundle.Administation}"
                            rendered="#{sessionBean.userAdmin}"
                            actionListener="#{_explorerBean.onOpenAdmCardForm(item)}"/>                
            </p:splitButton>                           

            <p:splitButton value="#{bundle.Delete}"  
                            rendered="#{item.deleted}"
                            disabled="#{!sessionBean.userAdmin}"
                            update="centerFRM westFRM"
                            actionListener="#{_explorerBean.onDeleteContentFromTrash(item)}"
                            onstart="PF('statusDialog').show()"
                            oncomplete="PF('statusDialog').hide(); initDND()">
                <p:confirm header="#{bundle.ConfirmDelete}" message="#{bundle.OperationIsNotReversible}" icon="ui-icon-alert" />
                <p:menuitem value="#{bundle.Restore}"
                            icon="ui-icon-arrowreturnthick-1-w"
                            update="centerFRM westFRM"
                            actionListener="#{_explorerBean.onRestoreContentFromTrash(item)}"
                            onstart="PF('statusDialog').show()"
                            oncomplete="PF('statusDialog').hide(); initDND()">
                </p:menuitem>                
            </p:splitButton>
        </p:column>
    </p:dataTable>        
    <pe:tooltip for="tblDetail" value="#{_explorerBean.tableToolTip}" rendered="#{!empty(_explorerBean.tableToolTip)}"
                mouseTracking="true" myPosition="top left" adjustX="10" adjustY="10"                 
                styleClass="qtip qtip-rounded qtip-shadow" header="#{bundle.Info}"/>
    
    <ui:include src="/view/common/confirm-dlg.xhtml"/>
</ui:composition>