<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"    
                xmlns:h="http://java.sun.com/jsf/html" 
                xmlns:p="http://primefaces.org/ui">

    <p:dataTable id="tblDetail" value="#{explorerBean.detailItems}" var="item"
                 emptyMessage="#{bundle.EmptyTable}"
                 paginator="true" paginatorPosition="bottom" first="#{explorerBean.currentPage}"
                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                 rowsPerPageTemplate="5, 10, 15, 20, 35, 50, 75, 100" rows="#{explorerBean.rowsInPage}"
                 currentPageReportTemplate="#{bundle.CountRecords}: {totalRecords}, #{bundle.Showing} {startRecord}-{endRecord} "
                 tableStyle="table-layout: auto;" styleClass="ui-grid-col-12 without-spaces"
                 sortMode="multiple" sortBy="#{explorerBean.sortOrder}"
                 selection="#{explorerBean.checkedItems}"
                 rowKey="#{item.itemKey}">

        <p:ajax event="rowDblselect" 
                listener="#{explorerBean.onRowDblClckOpen}"
                oncomplete="document.getElementById('#{_frmExpl}:vedCardBtn').click();"/>
        <p:ajax event="rowSelectCheckbox" update="#{_frmExpl}:explToolBar" oncomplete="initDND()"/>
        <p:ajax event="rowUnselectCheckbox" update="#{_frmExpl}:explToolBar" oncomplete="initDND()"/>
        <p:ajax event="toggleSelect" update="#{_frmExpl}:explToolBar" oncomplete="initDND()"/>
        <p:ajax event="page" listener="#{explorerBean.onPageChange}" oncomplete="initDND()"/>             
        
        <p:column width="16" selectionMode="multiple" style="text-align:center"/>

        <p:column width="16" sortBy="#{item.state.currentState.name}">
            <h:graphicImage id="iconDone" value="#{item.state.currentState.icon}" title="#{item.state.currentState.bundleName}"/>            
        </p:column>
        
        <p:column width="16" sortBy="#{item.iconName}" id="colIcon">
            <p:graphicImage id="itemIcon" value="/resources/icon/#{item.iconName}.png" styleClass="#{item.deleted ? '' : 'dropoint'}"/> 
        </p:column>

        <ui:insert name="specDetailColumns"/>
        
        <p:column headerText="#{bundle.ShortName}" sortBy="#{item.nameEndElipse}" id="shortName">
            <p:commandLink value="#{item.nameEndElipse}" title="#{item.name}" 
                           rendered="#{explorerBean.isItemTreeType(item)}"
                           actionListener="#{explorerBean.onLoadGroupContent(item)}"
                           update="#{_frmExpl} #{_frmTree} centerHeaderLabel #{_updates}" 
                           oncomplete="initDND()"/>
            <p:commandLink value="#{item.nameEndElipse}" title="#{item.name}"
                           rendered="#{!explorerBean.isItemTreeType(item) and item.getClass().getSimpleName() != 'Doc'}"
                           actionListener="#{explorerBean.onSetCurrentItem(item)}"
                           oncomplete="document.getElementById('#{_frmExpl}:editCardBtn').click();">
            </p:commandLink>
            <ui:insert name="specCommandLinks"/>
        </p:column>
       
        <ui:insert name="specTreeColumns"/>
        <ui:insert name="specRootColumns"/>
        
        <p:column headerText="#{bundle.DateChange}" priority="3"
                  rendered="#{_showDateChange != false}"
                  sortBy="#{item.dateChange}">
            <h:outputLabel value="#{item.dateChange}">
                <f:convertDateTime type="both" dateStyle="short" timeStyle="short" locale="#{sessionBean.locale}" timeZone="#{TimeZone.getDefault()}"/>
            </h:outputLabel>
        </p:column>

        <p:column headerText="#{bundle.DateCreate}" width="90" priority="3"
                  rendered="#{_showDateCreate != false}"
                  sortBy="#{item.dateCreate}">
            <h:outputLabel value="#{item.dateCreate}">
                <f:convertDateTime type="both" dateStyle="short" timeStyle="short" locale="#{sessionBean.locale}" timeZone="#{TimeZone.getDefault()}"/>
            </h:outputLabel>
        </p:column>

        <p:column headerText="#{bundle.Owner}" priority="4"
                  rendered="#{_showAuthor == true}"
                  sortBy="#{item.author.shortFIO}">
            #{item.author.shortFIO}
        </p:column>

        <p:column headerText="Id" style="width:15px;" priority="5" rendered="#{_showId == true}">
            #{item.id}
        </p:column>

        <p:column style="text-align: center;" width="90" >
            <p:splitButton  value="#{bundle.Select}"
                            rendered="#{!item.deleted and item.actual and explorerBean.selectorViewMode}" 
                            action="#{explorerBean.onSelect(item)}">                
                <p:menuitem value="#{bundle.View}" icon="ui-icon-search"
                            actionListener="#{explorerBean.onSetCurrentItem(item)}"
                            oncomplete="document.getElementById('#{_frmExpl}:editCardBtn').click();"/>
                <p:menuitem value="#{bundle.Edit}" icon="ui-icon-pencil"
                            actionListener="#{explorerBean.onSetCurrentItem(item)}"
                            oncomplete="document.getElementById('#{_frmExpl}:viewCardBtn').click();"/>
            </p:splitButton>                      
                        
            <p:splitButton value="#{bundle.Edit}"
                           actionListener="#{explorerBean.onSetCurrentItem(item)}"
                           rendered="#{!item.deleted and explorerBean.explorerViewMode}"
                           oncomplete="document.getElementById('#{_frmExpl}:viewCardBtn').click();">
                <ui:insert name="addItemMenu" />                 
                <p:separator/>
                <p:menuitem icon="ui-icon-search" value="#{bundle.ViewCard}" 
                            actionListener="#{explorerBean.onSetCurrentItem(item)}"
                            oncomplete="document.getElementById('#{_frmExpl}:editCardBtn').click();"/>
                <p:separator/>

                <p:menuitem icon="ui-icon-copy" value="#{bundle.Copy}"
                            update="#{_frmExpl}:menuTbl"
                            actionListener="#{explorerBean.onCopyItem(item)}"/>
                <p:menuitem icon="ui-icon-trash" value="#{bundle.MoveToTrash}"
                            disabled="#{item.id == 0}"
                            update="#{_frmTree} #{_frmExpl}"
                            actionListener="#{explorerBean.onMoveContentToTrash(item)}"
                            oncomplete="initDND()">
                    <p:confirm header="#{bundle.Move}" message="#{bundle.ConfirmMoveToTrash}" icon="ui-icon-alert" />
                </p:menuitem>

                <p:separator/>
                <p:menuitem icon="ui-icon-star" value="#{bundle.AddToFavorites}" 
                            rendered="#{!explorerBean.isFavoriteSelected()}"
                            actionListener="#{explorerBean.onAddContentInFavorites(item)}"/>
                <p:menuitem icon="ui-icon-scissors" value="#{bundle.DeleteFromFavorites}" 
                            rendered="#{explorerBean.isFavoriteSelected()}"
                            actionListener="#{explorerBean.onDelContentFromFavorites(item)}"
                            update="#{_frmExpl}"
                            oncomplete="initDND()"/>
                <p:separator/>
                <p:menuitem icon="ui-icon-key" value="#{bundle.Administation}"
                            rendered="#{sessionBean.userAdmin}"
                            actionListener="#{explorerBean.onOpenAdmCardForm(item)}"/>                
            </p:splitButton>                           

            <p:splitButton value="#{bundle.Delete}"  
                            rendered="#{item.deleted}"
                            disabled="#{!sessionBean.userAdmin}"
                            update="#{_frmExpl} #{_frmTree}"
                            actionListener="#{explorerBean.onDeleteContentFromTrash(item)}"
                            oncomplete="initDND()">
                <p:confirm header="#{bundle.ConfirmDelete}" message="#{bundle.OperationIsNotReversible}" icon="ui-icon-alert" />
                <p:menuitem value="#{bundle.Restore}"
                            icon="ui-icon-arrowreturnthick-1-w"
                            update="#{_frmExpl} #{_frmTree}"
                            actionListener="#{explorerBean.onRestoreContentFromTrash(item)}"
                            oncomplete="initDND()">
                </p:menuitem>                
            </p:splitButton>
        </p:column>
    </p:dataTable>
    
    <p:contextMenu id="menuTbl" for="tblDetail" >
        <p:menuitem value="#{bundle.CopySelected}" icon="ui-icon-copy"
                    actionListener="#{explorerBean.onCopySelectedItem()}"/>
        <p:menuitem value="#{bundle.Paste}" icon="ui-icon-clipboard"
                    actionListener="#{explorerBean.onPasteItemToTable()}"
                    update="#{_frmExpl} #{_frmTree}"/>
    </p:contextMenu>

    <ui:include src="/view/common/confirm-dlg.xhtml"/>
</ui:composition>