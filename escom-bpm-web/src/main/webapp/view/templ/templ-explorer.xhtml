<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"               
                xmlns:pe="http://primefaces.org/ui/extensions"               
                template="/view/templ/templ.xhtml">

    <ui:define name="initBeans">
        <ui:param name="_searcheBean" value="#{_searcheBean == null ? _detailBean : _searcheBean}" />
        #{explorerBean.setSelectorHeader(_selectorHeader)}
        #{explorerBean.setExplorerHeader(_explorerHeader)}
        
        #{_rootBean  != null ? explorerBean.setRootBean(_rootBean) : ''}
        #{_detailBean != null ? explorerBean.setTableBean(_detailBean)  : ''}
        #{_treeBean   != null ? explorerBean.setTreeBean(_treeBean) : ''}
        #{explorerBean.setSearcheBean(_searcheBean)}

        #{_treeBean != null ? _treeBean.setDetailBean(_detailBean) : ''}
        #{_treeBean != null ? _treeBean.setOwnerBean(_rootBean) : ''}
        #{_treeBean != null ? _treeBean.setExplorerBean(explorerBean) : ''}

        #{_treeBean != null ? _detailBean.setOwnerBean(_treeBean) : ''}
        #{_detailBean.setExplorerBean(explorerBean)}


        #{_rootBean != null ? _rootBean.setDetailBean(_treeBean) : ''} <!-- это установка бина верхнего уровня Company для Department -->
        #{_rootBean != null ? _rootBean.setExplorerBean(explorerBean) : ''}
        
        <ui:param name="_frmExpl" value="explorer"/>
        <ui:param name="_frmTree" value="explorer_west"/>
    </ui:define>
    
    <ui:define name="title">
        #{explorerBean.jurnalHeader}
    </ui:define>

    <ui:define name="preRendered">
        <f:metadata>
            <f:event type="preRenderView" listener="#{explorerBean.onOpen()}"/>
            <ui:insert name="preRenderAction" />
        </f:metadata>
    </ui:define>
    
    <ui:define name="body">
        <p:growl id="messages" showDetail="true" autoUpdate="true" life="6000"/>       

        <p:focus for="#{_frmTree}" context="nameSearche"/>

        <pe:layout fullPage="true" options="#{_detailBean.layoutOptions}" widgetVar="fpLayoutWidget">
            <h:outputScript library="js" name="drag-drop.js" />

            <pe:layoutPane position="north" resizable="true" rendered="#{_detailBean.northVisible}">
                <h:form style="font-size: 90%;">
                    <ui:insert name="north"/>
                </h:form>
            </pe:layoutPane>

            <pe:layoutPane position="west" resizable="true" rendered="#{_detailBean.westVisible}">
                <f:facet name="header">
                    <p:outputLabel value="#{bundle.Sections}" />
                </f:facet>
                <h:form id="#{_frmTree}" style="font-size: 90%;"> 
                    <style>
                        .ui-accordion .ui-accordion-content {
                            padding: 0px !important;
                        }
                    </style>
                    <ui:include src="/view/templ/tree/tree.xhtml" />
                </h:form>
            </pe:layoutPane>

            <pe:layoutPane position="center" resizable="true">
                <pe:layoutPane position="center">
                    <f:facet name="header">  
                        <p:outputLabel id="centerHeaderLabel" value="#{explorerBean.jurnalHeader}" />
                    </f:facet>

                    <h:form id="#{_frmExpl}" style="font-size: 80%;">
                        <p:remoteCommand name="dropToTree"  actionListener="#{explorerBean.dropToTree}"  update="#{_frmTree} #{_frmExpl}" oncomplete="initDND()"/>
                        <p:remoteCommand name="dropToTable" actionListener="#{explorerBean.dropToTable}" update="#{_frmTree} #{_frmExpl}" oncomplete="initDND()"/>                     
                        <p:remoteCommand name="dropToNavig" actionListener="#{explorerBean.dropToNavig}" update="#{_frmTree} #{_frmExpl}" oncomplete="initDND()"/>   

                        <p:commandButton id="editCardBtn" actionListener="#{explorerBean.onEditContentItem()}" style="display: none;"> 
                            <p:ajax event="dialogReturn" 
                                    update="#{_frmTree} #{_frmExpl}"
                                    listener="#{explorerBean.onUpdateAfterCloseForm}" oncomplete="initDND()"/>
                        </p:commandButton>

                        <p:commandButton id="viewCardBtn" actionListener="#{explorerBean.onViewContentItem()}" style="display: none;">
                            <p:ajax event="dialogReturn" 
                                    update="#{_frmExpl}"
                                    oncomplete="initDND()"/>
                        </p:commandButton>

                        <ui:include src="/view/templ/expl/expl-toolbar.xhtml"/>                    
                        <ui:include src="/view/templ/tree/tree-navigator.xhtml"/>
                        <ui:include src="/view/templ/expl/expl-table.xhtml"/>                        

                    </h:form>
                </pe:layoutPane>

                <pe:layoutPane position ="south" rendered="#{_showUploadPanel == true}" >
                    <ui:include src="/view/common/file-uppload.xhtml" />
                </pe:layoutPane> 
            </pe:layoutPane>

            <pe:layoutPane position="east" resizable="true" rendered="#{_detailBean.eastVisible}" >
                <f:facet name="header">  
                    <p:outputLabel value="#{bundle.Searche}" />
                </f:facet> 
                <h:form style="font-size: 80%;" id="#{_frmExpl}_east"> 
                    <ui:include src="/view/templ/templ-searche.xhtml">
                        <ui:param name="_tblUpdate" value="#{_frmExpl} #{_frmTree} centerHeaderLabel #{_updates}"/>
                    </ui:include>
                </h:form>
            </pe:layoutPane>

            <ui:include src="/view/templ/expl/expl-southpane.xhtml"/>

        </pe:layout>

    </ui:define>
</ui:composition>