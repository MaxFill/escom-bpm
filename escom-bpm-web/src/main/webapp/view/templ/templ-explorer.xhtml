<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"               
                xmlns:pe="http://primefaces.org/ui/extensions"               
                template="/view/templ/templ.xhtml">

    <ui:define name="initBeans">
        <ui:param name="_searcheBean" value="#{_searcheBean == null ? _detailBean : _searcheBean}" />
        <ui:param name="_explorerBean" value="#{_explorerBean == null ? explorerBean : _explorerBean}" />

        #{_explorerBean.setSelectorHeader(_selectorHeader)}
        #{_explorerBean.setExplorerHeader(_explorerHeader)}
        #{_explorerBean.setSearcheBean(_searcheBean)}

        #{_rootBean   != null ? _explorerBean.setRootBean(_rootBean) : ''}
        #{_detailBean != null ? _explorerBean.setTableBean(_detailBean)  : ''}
        #{_treeBean   != null ? _explorerBean.setTreeBean(_treeBean) : ''}

        <ui:param name="_frmExpl" value="explorer"/>
        <ui:param name="_frmTree" value="explorer_west"/>
    </ui:define>

    <ui:define name="title">
        #{_explorerBean.jurnalHeader}
    </ui:define>

    <ui:define name="preRendered">
        <f:metadata>
            <f:event type="preRenderView" listener="#{_explorerBean.onOpenExplorer()}"/>
            <ui:insert name="preRenderAction" />
        </f:metadata>
    </ui:define>

    <ui:define name="body">        
        <pe:layout fullPage="true" options="#{_explorerBean.layoutOptions}" stateCookie="true" widgetVar="fpLayoutWidget">
            
            <h:outputScript library="js" name="confirm-close-window.js" rendered="#{!_explorerBean.selectorViewMode}" /> 
            <h:outputScript library="js" name="drag-drop.js" />  
            
            <pe:layoutPane position="west" resizable="true">
                <f:facet name="header">
                    <p:outputLabel value="#{bundle.Sections}" />
                </f:facet>
                <h:form id="#{_frmTree}" style="font-size: 90%;"> 
                    <style>
                        .ui-accordion .ui-accordion-content {
                            padding: 0px !important;
                        }
                    </style>
                    <p:focus context="#{_frmTree}" for="#{_frmTree}:accord:nameSearche"/>
                    <ui:include src="/view/templ/tree/tree.xhtml" />                    
                </h:form>
            </pe:layoutPane>

            <pe:layoutPane position="center" resizable="true">
                <pe:layoutPane position="center">
                    <f:facet name="header">
                        <p:outputLabel id="centerHeaderLabel" value="#{_explorerBean.jurnalHeader}" />
                    </f:facet>

                    <h:form id="#{_frmExpl}" style="font-size: 80%;">
                        <p:remoteCommand name="dropToTree"  actionListener="#{_explorerBean.dropToTree}"  update="#{_frmTree} #{_frmExpl}" oncomplete="initDND()"/>
                        <p:remoteCommand name="dropToTable" actionListener="#{_explorerBean.dropToTable}" update="#{_frmTree} #{_frmExpl}" oncomplete="initDND()"/>
                        <p:remoteCommand name="dropToNavig" actionListener="#{_explorerBean.dropToNavig}" update="#{_frmTree} #{_frmExpl}" oncomplete="initDND()"/>                           

                        <p:commandButton id="viewCardBtn" actionListener="#{_explorerBean.onEditContentItem()}" 
                                         onstart="PF('statusDialog').show()"
                                         oncomplete="PF('statusDialog').hide();"
                                         style="display: none;">
                            <p:ajax event="dialogReturn" listener="#{_explorerBean.onUpdateAfterCloseForm}"
                                    update="#{_frmExpl} #{_frmTree}"
                                    oncomplete="initDND()"/>
                        </p:commandButton>
                        
                        <p:commandButton id="editCardBtn" actionListener="#{_explorerBean.onViewContentItem()}"
                                         onstart="PF('statusDialog').show()"
                                         oncomplete="PF('statusDialog').hide();"
                                         update="" style="display: none;">
                            <p:ajax event="dialogReturn" 
                                    update="#{_frmExpl}"
                                    oncomplete="initDND()"/>
                        </p:commandButton>
                        
                        <p:commandButton id="editDocument" actionListener="#{_explorerBean.onEditDocument()}"
                                         onstart="PF('statusDialog').show()"
                                         oncomplete="PF('statusDialog').hide();"
                                         update="" style="display: none;">
                            <p:ajax event="dialogReturn" 
                                    update="#{_frmExpl}" listener="#{_explorerBean.onUpdateAfterChangeItem}"
                                    oncomplete="initDND()"/>
                        </p:commandButton>                                                 
                        
                        <p:commandButton id="btnScan" icon="ui-icon-clipboard" style="display: none;"     
                                actionListener="#{sessionBean.openScaningForm()}"> 
                            <p:ajax event="dialogReturn" listener="#{_explorerBean.addAttacheFromScan}"/>
                        </p:commandButton>
                        
                        <ui:include src="/view/templ/expl/expl-toolbar.xhtml"/> 
                        <p:messages id="messages" showDetail="true" closable="true" styleClass="ui-panelgrid-blank ui-grid-col-12 col-padding">
                            <p:autoUpdate />
                        </p:messages>
                        <ui:include src="/view/templ/tree/tree-navigator.xhtml"/>
                        <ui:include src="/view/templ/expl/expl-table.xhtml"/>
                        
                    </h:form>
                </pe:layoutPane>

                <pe:layoutPane position ="south" rendered="#{_showUploadPanel == true}" >
                    <ui:include src="/view/common/file-uppload.xhtml" />
                </pe:layoutPane> 
            </pe:layoutPane>

            <pe:layoutPane position="east" resizable="true" >
                <f:facet name="header">  
                    <p:outputLabel value="#{bundle.Searche}" />
                </f:facet> 
                <h:form style="font-size: 80%;" id="#{_frmExpl}_east"> 
                    <ui:include src="/view/templ/templ-searche.xhtml">
                        <ui:param name="_tblUpdate" value="#{_frmExpl} #{_frmTree} centerHeaderLabel #{_updates}"/>
                    </ui:include>
                </h:form>
            </pe:layoutPane>

            <ui:include src="/view/templ/expl/expl-southpane.xhtml"/>
        </pe:layout> 
        <ui:include src="/view/common/error-dlg.xhtml"/>
    </ui:define>
</ui:composition>