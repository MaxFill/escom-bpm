<ui:composition  xmlns="http://www.w3.org/1999/xhtml"
                 xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                 xmlns:p="http://primefaces.org/ui"
                 xmlns:h="http://xmlns.jcp.org/jsf/html">

    <ui:include src="/view/common/drag-drop-dlg.xhtml"/>

    <ui:param name="_CreateGroupLabel" value="#{_CreateGroupLabel == null ? bundle.CreateGroup : _CreateGroupLabel}" />

    <p:commandButton id="createTreeCardBtn" action="#{_explorerBean.onCreateTreeItem()}" 
                     onstart="PF('statusDialog').show()"
                     oncomplete="PF('statusDialog').hide();"
                     style="display: none;"> 
        <p:ajax event="dialogReturn" 
                update="#{_frmTree} #{_frmExpl}"
                listener="#{_explorerBean.onUpdateAfterCloseForm}" oncomplete="initDND()"/>
    </p:commandButton>
    <p:commandButton id="createRootCardBtn" action="#{_explorerBean.onCreateRootItem()}" 
                     onstart="PF('statusDialog').show()"
                     oncomplete="PF('statusDialog').hide();"
                     style="display: none;"> 
        <p:ajax event="dialogReturn" 
                update="#{_frmTree} #{_frmExpl}"
                listener="#{_explorerBean.onUpdateAfterCloseForm}" oncomplete="initDND()"/>
    </p:commandButton>

    <p:commandButton id="openTreeCardBtn" actionListener="#{_explorerBean.onEditContentItem()}"
                     onstart="PF('statusDialog').show()"
                     oncomplete="PF('statusDialog').hide();" style="display: none;"> 
        <p:ajax event="dialogReturn" 
                update="#{_frmTree} #{_frmExpl}"
                listener="#{_explorerBean.onUpdateAfterCloseForm}" oncomplete="initDND()"/>
    </p:commandButton>

    <p:commandButton id="viewTreeCardBtn" actionListener="#{_explorerBean.onViewContentItem()}" 
                     onstart="PF('statusDialog').show()"
                     oncomplete="PF('statusDialog').hide();"
                     style="display: none;"> 
        <p:ajax event="dialogReturn" oncomplete="initDND()"/>
    </p:commandButton>

    <p:accordionPanel id="accord" widgetVar="accordion" activeIndex="#{_explorerBean.currentTab}">
        <p:ajax event="tabChange" listener="#{_explorerBean.onTreeTabChange}"
                update="#{_frmExpl} centerHeaderLabel #{_updates}"
                oncomplete="initDND()"/>

        <p:tab id="tabTree" title="#{bundle.Groups}" rendered="#{_treeBean != null}">
            <ui:include src="/view/templ/tree/tree-toolbar.xhtml"/>

            <p:tree id="tree" value="#{_explorerBean.tree}" var="treeItem"  
                    selectionMode="single" animate="true" 
                    selection="#{_explorerBean.treeSelectedNode}" style="width: auto; overflow-y: auto;">

                <p:treeNode type="#{_explorerBean.typeRoot}" icon="#{treeItem.iconTree}">
                    <h:outputText value="#{treeItem.getNameEndElipse()}" title="#{treeItem.name}"/>
                </p:treeNode>
                
                <p:treeNode type="tree" expandedIcon="ui-icon-folder-open" collapsedIcon="ui-icon-folder-collapsed">
                    <h:outputText value="#{treeItem.getNameEndElipse()}" title="#{treeItem.name}"/>
                </p:treeNode>

                <p:ajax event="select" listener="#{_explorerBean.onTreeNodeSelect}"
                        update="centerHeaderLabel #{_frmTree}:accord:toolbarTree #{_frmTree}:accord:menuTree #{_frmExpl} #{_updates}"
                        oncomplete="initDND()"/>
                <p:ajax event="contextMenu" listener="#{_explorerBean.onTreeNodeSelect}"
                        update="centerHeaderLabel #{_frmTree}:accord:toolbarTree #{_frmExpl} #{_updates}"
                        oncomplete="initDND()"/>
                <p:ajax event="expand"  listener="#{_explorerBean.onNodeExpand}" />
                <p:ajax event="collapse" listener="#{_explorerBean.onNodeCollapse}" />
            </p:tree>
            
            <p:contextMenu id="menuTree" for="tree" widgetVar="menuTree">
                <p:menuitem value="#{bundle.Select}" icon="ui-icon-check"
                            rendered="#{_explorerBean.selectorViewMode}"
                            action="#{_explorerBean.onSelectTreeItem()}"/>
                <p:separator rendered="#{_explorerBean.selectorViewMode}"/>
                <p:menuitem icon="ui-icon-circle-plus" value="#{_CreateRootLabel}" rendered="#{_CreateRootLabel != null}"
                            oncomplete="document.getElementById('#{_frmTree}:createRootCardBtn').click();"/>
                <p:menuitem icon="ui-icon-plus" value="#{_CreateGroupLabel}"
                            oncomplete="document.getElementById('#{_frmTree}:createTreeCardBtn').click();"/>
                <p:separator />
                <p:menuitem value="#{bundle.Expand}" icon="ui-icon-folder-open" 
                            update="#{_frmTree}" oncomplete="initDND()"
                            actionListener="#{_explorerBean.onExpandNode()}"/>
                <p:menuitem value="#{bundle.Collapse}" icon="ui-icon-folder-collapsed" 
                            update="#{_frmTree}" oncomplete="initDND()"
                            actionListener="#{_explorerBean.onCollapseNode()}"/>                
                <p:separator />
                <p:menuitem value="#{bundle.View}" icon="ui-icon-search"
                            oncomplete="document.getElementById('#{_frmTree}:viewTreeCardBtn').click();"/>
                <p:menuitem value="#{bundle.Edit}" icon="ui-icon-pencil"
                            oncomplete="document.getElementById('#{_frmTree}:openTreeCardBtn').click();"/>
                <p:separator />                

                <p:menuitem icon="ui-icon-star" value="#{bundle.AddToFavorites}" 
                            actionListener="#{_explorerBean.onAddContentInFavorites()}"/>
                <p:separator/>

                <p:menuitem icon="ui-icon-key" value="#{bundle.Administation}"
                            onstart="PF('statusDialog').show()"
                            oncomplete="PF('statusDialog').hide();"
                            rendered="#{sessionBean.userAdmin}"
                            actionListener="#{_explorerBean.onOpenAdmCardForm()}"/>
            </p:contextMenu>
        </p:tab>

        <p:tab id="tabFilter" title="#{bundle.Filters}">
            <ui:include src="/view/templ/tree/tree-filters.xhtml" />
        </p:tab>

    </p:accordionPanel>

</ui:composition>