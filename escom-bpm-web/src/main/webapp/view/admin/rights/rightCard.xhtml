<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:pe="http://primefaces.org/ui/extensions"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    template="/view/templ/templ-dlg.xhtml">

    <ui:define name="title">
        #{bundle.RightsFor} #{bundle.State} [#{rightCardBean.stateName}]
    </ui:define>

    <ui:param name="_bean" value="#{rightCardBean}"/>

    <ui:define name="menuActions" >
        <p:menuitem icon="ui-icon-circle-check" value="#{bundle.SaveAndClose}"
                    onclick="document.getElementById('centerFRM:btnSave').click();">
        </p:menuitem>
    </ui:define>

    <ui:define name="toolbarComponents" >
        <p:commandButton id="btnSave" value="#{bundle.SaveAndClose}"
                         title="#{bundle.SaveAndClose}"
                         update="centerFRM"
                         action="#{rightCardBean.onSaveChangeRight()}"
                         onclick="if (itemChange == 1)
                                                 onChangeItem();">
            <f:param name="isRequired" value="true"/>
        </p:commandButton>
    </ui:define>

    <ui:define name="centerFormContent">
        <p:outputLabel value="#{bundle.RrightsAreSet}:" />

        <p:selectOneRadio id="rbRightType" value="#{rightCardBean.objType}" layout="custom" style="float: right;">
            <f:selectItem itemLabel="#{bundle.ForGroup}" itemValue="0" />
            <f:selectItem itemLabel="#{bundle.ForUser}"  itemValue="1" />
            <f:selectItem itemLabel="#{bundle.ForRole}"  itemValue="2" />
            <p:ajax event="valueChange" update="centerFRM" oncomplete="itemChange = 1;"/>
        </p:selectOneRadio>

        <p:panelGrid id="options" columns="3" styleClass="ui-panelgrid-blank">
            <p:outputLabel value="#{bundle.ForUser}"
                           styleClass="#{rightCardBean.objType == 1 ? '': 'value'}"
                           />
            <p:radioButton id="optUser" for="rbRightType" itemIndex="1" />
            <p:selectOneMenu id="selUser" value="#{rightCardBean.selUser}" filter="true" filterMatchMode="startsWith"
                             valueChangeListener="#{rightCardBean.onUserChange}" styleClass="ui-grid-col-12"
                             required="#{param['isRequired'] == 'true' and rightCardBean.objType == 1}"
                             requiredMessage="#{bundle.Field} [#{bundle.ForUser}] #{bundle.MustBeFilled}"
                             converter="usersConvertor"
                             disabled="#{rightCardBean.objType != 1}">
                <f:selectItems value="#{rightCardBean.users}" var="users" itemLabel="#{users.shortFIO}" itemValue="#{users}"/>
                <f:selectItem itemValue="#{rightCardBean.selUser}" itemLabel="#{rightCardBean.selUser.shortFIO}" />
                <p:ajax event="change" oncomplete="itemChange = 1;"/>
            </p:selectOneMenu>

            <p:outputLabel value="#{bundle.ForGroup}"
                           styleClass="#{rightCardBean.objType == 0 ? '': 'value'}"
                           />
            <p:radioButton id="optGroup" for="rbRightType" itemIndex="0" />
            <p:selectOneMenu id="selGroup" value="#{rightCardBean.selUsGroup}"  filter="true" filterMatchMode="startsWith"
                             valueChangeListener="#{rightCardBean.onGroupChange}" styleClass="ui-grid-col-12"
                             required="#{param['isRequired'] == 'true' and rightCardBean.objType == 0}"
                             requiredMessage="#{bundle.Field} [#{bundle.ForGroup}] #{bundle.MustBeFilled}"
                             converter="groupsUserConvertor"
                             disabled="#{rightCardBean.objType != 0}" >
                <f:selectItems value="#{rightCardBean.userGroupses}" var="groups" itemLabel="#{groups.name}" itemValue="#{groups}"/>
                <f:selectItem itemValue="#{rightCardBean.selUsGroup}" itemLabel="#{rightCardBean.selUsGroup.name}" />
                <p:ajax event="change" oncomplete="itemChange = 1;"/>
            </p:selectOneMenu>

            <p:outputLabel value="#{bundle.ForRole}"
                           styleClass="#{rightCardBean.objType == 2 ? '': 'value'}"
                           />
            <p:radioButton id="optRole" for="rbRightType" itemIndex="2" />
            <p:selectOneMenu id="selRole" value="#{rightCardBean.selUsRole}"  filter="true" filterMatchMode="startsWith"
                             valueChangeListener="#{rightCardBean.onRoleChange}" styleClass="ui-grid-col-12"
                             converter="groupsUserConvertor"
                             required="#{param['isRequired'] == 'true' and rightCardBean.objType == 2}"
                             requiredMessage="#{bundle.Field} [#{bundle.ForRole}] #{bundle.MustBeFilled}"
                             disabled="#{rightCardBean.objType != 2}" >
                <f:selectItems value="#{rightCardBean.roles}" var="groups" itemLabel="#{groups.name}" itemValue="#{groups}"/>
                <f:selectItem itemValue="#{rightCardBean.selUsRole}" itemLabel="#{rightCardBean.selUsRole.name}" />
                <p:ajax event="change" oncomplete="itemChange = 1;"/>
            </p:selectOneMenu>
        </p:panelGrid>

        <p:separator />

        <h:panelGrid columns="1">
            <p:selectBooleanCheckbox id="chBoxAll" itemLabel="#{bundle.All}"
                                     valueChangeListener="#{rightCardBean.onChangeAllRight}"
                                     title="#{bundle.CheckUncheck}">
                <p:ajax update="chBoxPanel" oncomplete="itemChange = 1;"/>
            </p:selectBooleanCheckbox>
        </h:panelGrid>

        <p:panelGrid id="chBoxPanel" layout="grid" columns="2" columnClasses="ui-grid-col-6, ui-grid-col-6" styleClass="ui-panelgrid-blank ui-grid-col-10 without-spaces">
            <p:selectBooleanCheckbox value="#{rightCardBean.selRight.read}" id="chBoxRead"
                                     itemLabel="#{bundle.View}" onchange="itemChange = 1;"/>

            <p:selectBooleanCheckbox value="#{rightCardBean.selRight.update}" id="chBoxUpdate"
                                     itemLabel="#{bundle.Edit}" onchange="itemChange = 1;"/>

            <p:selectBooleanCheckbox value="#{rightCardBean.selRight.create}" id="chBoxCreate"
                                     rendered="#{rightCardBean.isShowCreateRight()}"
                                     itemLabel="#{bundle.Create}" onchange="itemChange = 1;"/>

            <p:selectBooleanCheckbox value="#{rightCardBean.selRight.delete}" id="chBoxDelete"
                                     itemLabel="#{bundle.Delete}" onchange="itemChange = 1;"/>

            <p:selectBooleanCheckbox value="#{rightCardBean.selRight.changeRight}" id="chBoxRight"
                                     itemLabel="#{bundle.ChangeRight}" onchange="itemChange = 1;"/>

            <p:selectBooleanCheckbox value="#{rightCardBean.selRight.addChild}"
                                     rendered="#{rightCardBean.isShowAddChildRight()}"
                                     itemLabel="#{bundle.AddChildsRight}" onchange="itemChange = 1;"/>

            <p:selectBooleanCheckbox value="#{rightCardBean.selRight.addDetail}"
                                     rendered="#{rightCardBean.isShowAddDetailRight()}"
                                     itemLabel="#{bundle.AddDetailRight}" onchange="itemChange = 1;"/>
        </p:panelGrid>
    </ui:define>
</ui:composition>