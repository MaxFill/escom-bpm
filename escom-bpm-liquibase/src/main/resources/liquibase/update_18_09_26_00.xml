<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog 
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9" 
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">         

    <changeSet id="doc_change_right_role_owner_state_valid" author="filatov" context="initdata" runOnChange="true">
        <sql>
            UPDATE `access` SET `IsCreate`=0, `IsDelete`=0, `IsUpdate`=0 where ObjLink = 1 and State = 7 and ObjId = 16;
        </sql>
    </changeSet>
    
    <changeSet id="messages_add_Content" author="filatov" context="initdata" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="userMessages" columnName="Content" />
            </not>
        </preConditions>
        <addColumn tableName="userMessages">
            <column name="Content" type="varchar(2500)" >
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>
    
    <changeSet id="conditions_add_Params" author="filatov" context="initdata" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="conditions" columnName="Params" />
            </not>
        </preConditions>
        <addColumn tableName="conditions">
            <column name="Params" type="varchar(1024)" >
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>
    
    <changeSet id="conditions_add_condition_agreedUponEmployee" author="filatov" context="initdata" runOnChange="true">
        <sql>
            INSERT conditions(Id, Name, Method, Params) VALUES (4, N'AgreedUponEmployee', N'agreedUponEmployee', N'{\"staff\":null}');
        </sql>
    </changeSet>
    
    <changeSet id="scheme_add_name" author="filatov" context="initdata" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="schemes" columnName="Name" />
            </not>
        </preConditions>
        <addColumn tableName="schemes">
            <column name="Name" type="varchar(250)" >
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>
    
    <changeSet id="states_change_name_confirm_Eliminated" author="filatov" context="initdata" runOnChange="true">
        <sql>
            UPDATE `states` SET `Name`='Eliminated' where Id = 13;
        </sql>
    </changeSet>
    
     <changeSet id="conditions_add_condition_lastApproved" author="filatov" context="initdata" runOnChange="true">
        <sql>
            INSERT conditions(Id, Name, Method) VALUES (5, N'LastApproved', N'lastApproved');
        </sql>
    </changeSet>
    
    <changeSet id="processesTypes_add_RunOptions" author="filatov" context="initdata" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="processesTypes" columnName="RunOptions" />
            </not>
        </preConditions>
        <addColumn tableName="processesTypes">
            <column name="RunOptions" type="varchar(1024)" >
                <constraints nullable="true"/>
            </column>
            <column name="InheritRunOptions" type="BOOLEAN" >
                <constraints nullable="true"/>
            </column>   
            <column name="TermHours" type="INT" >
                <constraints nullable="true"/>
            </column>
            <column name="InheritTaskOptions" type="BOOLEAN" >
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

     <changeSet id="RunOptions_add_startOptions" author="filatov" context="initdata" runOnChange="true">
        <sql>
            INSERT runOptions(Id, Name, BundleName, Icon) VALUES (0, N'run', N'Run', N'ui-icon-play');
            INSERT runOptions(Id, Name, BundleName, Icon) VALUES (1, N'send_all', N'NewEditionSendToAll', N'ui-icon-play');
            INSERT runOptions(Id, Name, BundleName, Icon) VALUES (2, N'send_notagree', N'SendJustDoNotAgree', N'ui-icon-play');
        </sql>
    </changeSet>
    
    <changeSet id="processesTypes_set_def_TermHours" author="filatov" context="initdata" runOnChange="true">
        <sql>
            UPDATE processesTypes SET TermHours=72;
        </sql>
    </changeSet>
    
    <changeSet id="conditions_add_condition_docIsConcorded" author="filatov" context="initdata" runOnChange="true">
        <sql>
            INSERT conditions(Id, Name, Method, Params) VALUES (6, N'DocIsConcorded', N'docIsConcorded', N'');
        </sql>
    </changeSet>
    
    <changeSet id="results_add_result_execute" author="filatov" context="initdata" runOnChange="true">
        <sql>
            INSERT resultsStates (Id, CurrentState,  PreviousState) VALUES(6, 7, 5);        
            INSERT results (Id, Name, IconName, State, IsInherits, IsDeleted, IsActual, IsInheritsAccessChilds, AccessChilds, Author, DateCreate, DateChange) 
                    VALUES (6, N'Execute', N'execute', 6, 1, 0, 1, NULL, NULL, 0, CAST('2016-12-12' AS DateTime), CAST('2016-12-12' AS DateTime));
        </sql>
    </changeSet>
        
    <changeSet id="processesTypes_add_ReportsOptions" author="filatov" context="initdata" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="processesTypes" columnName="ShowReports" />
            </not>
        </preConditions>
        <addColumn tableName="processesTypes">
            <column name="NameReports" type="varchar(255)" >
                <constraints nullable="true"/>
            </column>
            <column name="ShowReports" type="BOOLEAN" >
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>
</databaseChangeLog> 
